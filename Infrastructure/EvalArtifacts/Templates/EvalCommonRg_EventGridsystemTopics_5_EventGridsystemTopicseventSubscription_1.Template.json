{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "resources": [
    {
      "name": "[parameters('eventL2Name')]",
      "properties": {
        "destination": {
          "endpointType": "WebHook",
          "properties": {
	    "endpointUrl":"[parameters('endpointUrl')]",
            "maxEventsPerBatch": 1,
            "preferredBatchSizeInKilobytes": 64,
	    "azureActiveDirectoryTenantId": "33e01921-4d64-4f8c-a055-5bdaffd5e33d",
            "azureActiveDirectoryApplicationIdOrUri": "f1f8da5f-609a-401d-85b2-d498116b7265"
          }
        },
        "eventDeliverySchema": "EventGridSchema",
        "filter": {
          "includedEventTypes": [
            "Microsoft.Storage.BlobCreated",
            "Microsoft.Storage.BlobDeleted"
          ],
          "isSubjectCaseSensitive": false
        },
        "labels": [],
        "retryPolicy": {
          "eventTimeToLiveInMinutes": 1440,
          "maxDeliveryAttempts": 30
        }
      },
      "type": "Microsoft.EventGrid/systemTopics/eventSubscriptions",
      "condition": "[parameters('newOrExisting')]",
      "apiVersion": "2023-06-01-preview"
    }
  ],
  "parameters": {
    "eventL2Name": {
      "type": "string"
    },
    "endpointUrl": {
      "type": "string"
    },
    "newOrExisting": {
      "type": "bool"
    }
  }
}