{
  "$schema": "https://schema.management.azure.com/schemas/2015-01-01/deploymentParameters.json#",
  "contentVersion": "1.0.0.0",
  "paths": [
    "servicePackageLink"
  ],
  "parameters": {
    "appService_name": {
      "type": "string"
    },
    "appService_location": {
      "type": "string"
    },
    "appServicePlan_name": {
      "type": "string"
    },
    "Sites_buildVersion": {
      "type": "string"
    },
    "servicePackageLink": {
      "type": "string"
    },
    "alwaysOn": {
      "type": "bool",
      "defaultValue": true,
      "metadata": {
        "description": "Whether the web app should remain loaded after 20 minutes of inactivity."
      }
    },
    "environment": {
      "type": "string",
      "metadata": {
        "description": "Environment name (e.g., Production, Development)"
      }
    },
    "appInsightsConnectionString": {
      "type": "string",
      "metadata": {
        "description": "Application Insights Connection String"
      }
    },
    "storageAccountName": {
      "type": "string",
      "metadata": {
        "description": "Azure Storage Account Name"
      }
    }
  },
  "resources": [
    {
      "comments": "The App Service for Dev environment (no slot)",
      "apiVersion": "2022-09-01",
      "type": "Microsoft.Web/sites",
      "kind": "app",
      "name": "[parameters('appService_name')]",
      "location": "[parameters('appService_location')]",
      "properties": {
        "enabled": true,
        "serverFarmId": "[resourceId('Microsoft.Web/serverfarms', parameters('appServicePlan_name'))]",
        "buildVersion": "[parameters('Sites_buildVersion')]",
        "siteConfig": {
          "alwaysOn": "[parameters('alwaysOn')]",
          "netFrameworkVersion": "v8.0",
          "appSettings": [
            {
              "name": "Sites_buildVersion",
              "value": "[parameters('Sites_buildVersion')]"
            },
            {
              "name": "WEBSITE_RUN_FROM_PACKAGE",
              "value": "[parameters('servicePackageLink')]"
            },
            {
              "name": "ApiSettings__Environment",
              "value": "[parameters('environment')]"
            },
            {
              "name": "ApiSettings__Version",
              "value": "1.0.0"
            },
            {
              "name": "APPLICATIONINSIGHTS_CONNECTION_STRING",
              "value": "[parameters('appInsightsConnectionString')]"
            },
            {
              "name": "ApplicationInsightsAgent_EXTENSION_VERSION",
              "value": "~3"
            },
            {
              "name": "ASPNETCORE_ENVIRONMENT",
              "value": "[parameters('environment')]"
            },
            {
              "name": "AzureStorage__AccountName",
              "value": "[parameters('storageAccountName')]"
            },
            {
              "name": "AzureStorage__ConfigurationContainer",
              "value": "eval-configurations"
            },
            {
              "name": "AzureStorage__DefaultConfigurationBlob",
              "value": "default-metric-configuration.json"
            },
            {
              "name": "Logging__LogLevel__Default",
              "value": "Information"
            },
            {
              "name": "SCM_DO_BUILD_DURING_DEPLOYMENT",
              "value": "false"
            },
            {
              "name": "XDT_MicrosoftApplicationInsights_Mode",
              "value": "Recommended"
            }
          ]
        }
      }
    }
  ]
}
